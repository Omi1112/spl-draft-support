# 反省点：GraphQLリゾルバの実装におけるレイヤー分離

## 発生した問題

1. GraphQLリゾルバ内で直接リポジトリを使用して実装を行ってしまった
2. レイヤー間の責務分離が適切に行われなかった（GraphQL層からドメイン層に直接アクセス）
3. 命名規則の一貫性が不足しており、後から名前変更が必要になった
4. ユースケースの役割を明確に表現する名前になっていなかった

## 反省点と改善策

### 1. リゾルバでのリポジトリ直接使用

**問題点**：
リゾルバの実装において、初めはドメイン層のリポジトリを直接使用してデータを取得していた。これはレイヤー間の責務分離に反する実装であり、DDDの原則に沿っていない。

**改善策**：

- GraphQLリゾルバはアプリケーション層のユースケースのみを使用する
- ユースケースが存在しない場合は、新たに作成して利用する
- リポジトリへのアクセスはすべてユースケース内で行うようにする

### 2. 命名規則の不一致

**問題点**：
初めに作成したユースケースの名前が役割を明確に表していなかった。また、命名規則の一貫性が不足していたため、後から名前変更が必要になった。

**改善策**：

- ユースケースの命名は「動作+対象+条件」の形式で統一する
  - 例：`GetTournamentParticipantsByTournamentIdUseCase`
- 何を取得/操作するのか、どのような条件で取得/操作するのかを名前で明確に表現する
- 同様の操作を行う他のユースケースとの命名の一貫性を確保する

### 3. ファイルとクラスの名前の統一

**問題点**：
ファイル名とクラス名の不一致が生じる可能性があった。

**改善策**：

- ファイル名とクラス名は常に一致させる
- リネームが必要になった場合は、ファイル名とクラス名の両方を同時に更新する
- 参照しているインポート文や変数名も漏れなく更新する

## 教訓

1. GraphQLリゾルバはプレゼンテーション層であり、アプリケーション層（ユースケース）を介してのみドメイン層にアクセスするべき
2. ユースケース命名は「動作+対象+条件」の形式で統一し、役割を明確に表現する
3. コードレビュー時には特にレイヤー間の責務分離に注意を払う
4. 実装前に必要なユースケースの設計と命名規則を確認することで、後からの大きな変更を防ぐ
