# 事前読み込み

- prompt/index.md
- prompt/rule.md
- prompt/dir.md
- prompt/reflection.md

# タスク

## 目的

global変数を利用しない形に修正する。

## TODO リスト

1. コードベース全体からグローバル変数の使用箇所を特定する
2. グローバル変数を使用している各コンポーネントやモジュールを分析する
3. グローバル変数の代替方法を検討する
   - コンテキストAPI（React Context）による状態管理
   - 依存性注入パターンによる解決
   - 適切なフック（useReducer, useContext）の活用
   - 状態管理ライブラリ（Reduxなど）の検討
4. 各モジュールを個別に修正し、グローバル変数への依存を排除する
5. モジュール間でのデータ共有が必要な場合、適切な方法でデータを受け渡す実装に変更する
6. 修正後のコードをテストして機能が正常に動作することを確認する
7. 必要に応じてテストコードも更新する

## タスク実現のために必要な情報

### プロジェクト構造（prompt/index.md より）

- フロントエンド: Next.js (React)
- バックエンド: Next.js API Routes with GraphQL
- データベース: Prisma ORM
- テスト: Jest

現在のプロジェクトは Next.js、Prisma、GraphQL を使用したトーナメント管理システムです。フロントエンドとバックエンドの両方を含むフルスタックアプリケーションであるため、グローバル変数の依存関係は様々な層で発生している可能性があります。

### 作業ルール（prompt/rule.md より）

- 「厳格な型チェック（strict type checking）を使用したTypeScriptコードを生成してください」
- 「null/undefinedの可能性を考慮した安全なコードを書いてください」
- FE実装からBE実装（app/apiディレクトリ）への直接参照は行わないこと
- FE実装でBE APIを呼び出す際は、app/clientディレクトリに呼び出しファイルを作成すること

グローバル変数を排除する際も、これらのルールに従って実装する必要があります。特に厳格な型チェックとnull/undefinedの考慮は重要です。

### ディレクトリ構造（prompt/dir.md より）

- アプリケーションはDDDを採用しており、適切な責務分離が必要
- フロントエンド実装とバックエンド実装の分離
- hooks はpageディレクトリにhooksディレクトリを配置する必要がある

グローバル変数の排除に際して、アプリケーションのレイヤー間の責務分離を維持することが重要です。

### アーキテクチャの実装に関する注意点（prompt/reflection.md より）

- レイヤー間の明確な責務分離
- 依存性の方向に注意する（内側の層は外側の層に依存してはならない）
- テスト容易性と疎結合を維持する

グローバル変数はレイヤー間の不適切な依存関係を生み出しやすいため、その排除は適切な依存関係を確立する機会になります。特にDDDの原則に従って、適切な依存性の方向を維持することが重要です。
