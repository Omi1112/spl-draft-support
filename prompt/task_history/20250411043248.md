# タスク

## 概要

app/api/core/infrastructure/repositories/PrismaDraftRepository.ts にあるドラフトリセットロジックをドメインサービスとして抽出・定義する。

## 現状の問題点

現在、ドラフトのリセットロジックがリポジトリ層（インフラストラクチャ層）に実装されているが、これはドメインロジックであるためドメインサービスとして実装すべきである。

## 目標

- ドラフトリセット処理をドメインサービスとして再定義する
- リポジトリ層は純粋なデータアクセス操作のみを提供するようにする
- クリーンアーキテクチャの原則に従い、関心事の分離を徹底する

## TODOリスト

1. ドメインサービスのインターフェースを作成する

   - `DraftDomainService` インターフェースを定義する
   - リセット処理のメソッドシグネチャを定義する

2. ドメインサービスの実装クラスを作成する

   - `DraftDomainService` インターフェースを実装した `DraftDomainServiceImpl` クラスを作成する
   - リポジトリを利用して実際のリセット処理を実装する

3. 既存のリポジトリクラスを修正する

   - `PrismaDraftRepository` からリセットロジックを削除する
   - 必要に応じて、基本的なデータ操作メソッドを追加・修正する

4. ユースケースの作成/修正

   - リセット機能を利用するユースケースを作成/修正する
   - 新しいドメインサービスを利用するように変更する

5. テストの作成

   - ドメインサービスのテストを作成する
   - ユースケースのテストを作成/修正する

6. GraphQLリゾルバの修正（必要な場合）
   - 新しいドメインサービスを利用するように変更する

## 参考情報

### リポジトリとドメインサービスの責務分担

- リポジトリ：データアクセス操作のみを提供する（CRUD操作）
- ドメインサービス：ドメインに特化したビジネスルールを実装する

### ドメインサービスの特徴

- エンティティやバリューオブジェクトには自然に属さないドメインロジックを格納
- 複数のエンティティにまたがる操作を扱う
- トランザクション的な操作に関するロジックを扱う

### DDD実装のポイント

- 依存性の方向に注意する（内側の層は外側の層に依存しない）
- インフラストラクチャの詳細（PrismaClientなど）がアプリケーション層やドメイン層に漏れないようにする
- 依存性逆転の原則を守る

### テスト作成のポイント

- インターフェースと実装の一致を確認する
- エラーケースの網羅的テストを行う
- テスト間の独立性を確保する
