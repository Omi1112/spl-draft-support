# 事前読み込み

- prompt/index.md
- prompt/rule.md
- prompt/dir.md
- prompt/reflection.md

# タスク

## 目的

リポジトリからドメインロジックを完全に分離し、適切なドメイン層に移動する

## 問題点

前回の修正で、一部のリポジトリにまだドメインロジックが残っており、ドメイン層への移行が不完全な状態になっている。

## TODOリスト

1. TournamentParticipantRepositoryの全メソッドを点検し、残っているドメインロジックを特定する
2. 特定したドメインロジックをTournamentParticipantエンティティに移動する
3. リポジトリインターフェースをCRUD操作のみに純化する
4. 修正したインターフェースに基づいてPrismaTournamentParticipantRepositoryを更新する
5. TournamentParticipantエンティティのメソッドが全てのドメインロジックをカバーしていることを確認する
6. 変更の影響を受けるユースケースを特定し、必要に応じて修正する
7. 変更箇所に対応するテストを追加・修正する
8. すべての修正が完了したことを確認するためのレビューチェックリストを実行する

## 必要情報

### アーキテクチャの実装に関する注意点（prompt/reflection.mdより）

1. **レイヤー間の明確な責務分離**

   - アプリケーション層（ユースケース）は直接データベースにアクセスしてはいけない
   - データアクセスは常にリポジトリインターフェースを通じて行う
   - ユースケースはドメイン層のリポジトリインターフェースに依存し、実装の詳細を知らない設計を維持する

2. **依存性の方向に注意する**
   - 内側の層（ドメイン・アプリケーション）は外側の層（インフラストラクチャ）に依存してはいけない
   - インフラストラクチャの詳細（PrismaClientなど）がアプリケーション層に漏れていないか確認する
   - 依存性逆転の原則を守り、テスト容易性と疎結合を維持する

### DDDにおけるリポジトリの役割

- リポジトリはドメインオブジェクトの永続化と取得のみを担当し、ドメインロジックを含んではならない
- ビジネスルールはドメインエンティティやドメインサービスに実装されるべき
- リポジトリは「コレクションのような振る舞い」を提供し、データストアの詳細を隠蔽する
