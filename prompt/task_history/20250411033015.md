# 事前読み込み

- prompt/index.md
- prompt/rule.md
- prompt/dir.md
- prompt/reflection.md

# タスク

## 目的

`app/api/core/domain/repositories` 配下にあるドメインロジックを `app/api/core/domain` に移動し、適切なドメイン層での実装に修正する。

## TODOリスト

1. `app/api/core/domain/repositories` ディレクトリの内容を確認し、ドメインロジックを特定する
2. 特定したドメインロジックを `app/api/core/domain` 配下の適切な場所に移動・実装する
3. リポジトリインターフェースをドメインロジックから分離する
4. リポジトリの実装クラスがドメインロジックを使用するように修正する
5. 移動したドメインロジックを参照している箇所を新しい参照先に修正する
6. テストコードを修正・追加して動作確認を行う
7. 型エラーや実行時エラーがないことを確認する
8. 最終的なコードを整形して完成させる

## 必要情報

### アーキテクチャの実装に関する注意点（prompt/reflection.mdより）

1. **レイヤー間の明確な責務分離**

   - アプリケーション層（ユースケース）は直接データベースにアクセスしてはいけない
   - データアクセスは常にリポジトリインターフェースを通じて行う
   - ユースケースはドメイン層のリポジトリインターフェースに依存し、実装の詳細を知らない設計を維持する

2. **依存性の方向に注意する**
   - 内側の層（ドメイン・アプリケーション）は外側の層（インフラストラクチャ）に依存してはいけない
   - インフラストラクチャの詳細（PrismaClientなど）がアプリケーション層に漏れていないか確認する
   - 依存性逆転の原則を守り、テスト容易性と疎結合を維持する

### ディレクトリ構造（prompt/dir.mdより）

```
/workspace/
├── app/
│   ├── api/
│   │   ├── core/
│   │   │   ├── application/       # アプリケーション層
│   │   │   ├── domain/            # ドメイン層 - ドメインロジックはここに集約する
│   │   │   └── infrastructure/    # インフラストラクチャ層
```

### 作業ルール（prompt/rule.mdより）

- api ディレクトリは、DDD を採用しています。適切に分離してください。
- 「厳格な型チェック（strict type checking）を使用したTypeScriptコードを生成してください」
- 「null/undefinedの可能性を考慮した安全なコードを書いてください」
